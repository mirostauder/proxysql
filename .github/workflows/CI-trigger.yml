name: CI-trigger
run-name: '${{ github.ref_name }} ${{ github.workflow }} ${{ github.sha }}'

on:
  push:
#    branches: [ 'v[0-9]+.x','v[0-9]+.[0-9]+','v[0-9]+.[0-9]+.[0-9]+' ]
    paths-ignore:
    - '.github/**'
    - '**.md'
#  schedule:
#    - cron: '15 13 * * 3'
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref_name }}
  cancel-in-progress: true

jobs:
  trigger:
    runs-on: ubuntu-22.04

    steps:
    - name: Triggered CI-builds
      run: |
        echo "Triggered by workflow_run[in_progress]: '${{ github.ref_name }} CI-builds ${{ github.sha }}'"
        RUNID=$(gh -R ${{ github.repository }} run list | grep '${{ github.ref_name }} CI-builds ${{ github.sha }}' | grep -Po '(?<=workflow_run)\s+\d+')
        gh -R ${{ github.repository }} run watch -i 30 ${RUNID}

    - name: Triggered CI-dump
      run: |
        echo "Triggered by workflow_run[completed]: '${{ github.ref_name }} CI-dump ${{ github.sha }}'"
